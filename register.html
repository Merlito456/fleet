<script type="module">
import { db, auth } from './firebaseConfig.js';
import { collection, addDoc, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
import { createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";

// Register function
async function register(name, email, phone, password, role){
  try {
    // 1. Create user in Firebase Auth
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    // 2. Add user info to Firestore 'users' collection
    await addDoc(collection(db, "users"), {
      uid: user.uid,
      name,
      email,
      phone,
      role,
      createdAt: new Date()
    });

    localStorage.setItem("user", JSON.stringify({ uid: user.uid, name, email, phone, role }));
    alert("Registration successful!");
    window.location.href = "index.html"; // redirect after register
  } catch(err) {
    alert(err.message);
  }
}

// Form submission
document.getElementById('regForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const name = document.getElementById('name').value;
  const phone = document.getElementById('phone').value;
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  const role = document.getElementById('role').value;
  await register(name, email, phone, password, role);
});
</script>
