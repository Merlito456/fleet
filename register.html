<script type="module">
import { db, auth } from './firebaseConfig.js';
import { collection, addDoc } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
import { createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";

// Register function with input validation
async function register(name, email, phone, password, role){
  if (!name || !email || !password) {
    alert("Name, Email, and Password are required!");
    return;
  }
  if (password.length < 6) {
    alert("Password should be at least 6 characters.");
    return;
  }

  try {
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    await addDoc(collection(db, "users"), {
      uid: user.uid,
      name,
      email,
      phone,
      role,
      createdAt: new Date()
    });

    const profile = { uid: user.uid, name, email, phone, role };
    localStorage.setItem("user", JSON.stringify(profile));

    alert("Registration successful!");
    window.location.href = "index.html"; 
  } catch(err) {
    console.error(err);
    alert(err.message || "Registration failed.");
  }
}

// Wait for DOM to load
document.addEventListener('DOMContentLoaded', () => {
  const regForm = document.getElementById('regForm');
  if (regForm) {
    regForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const role = document.getElementById('role').value;
      await register(name, email, phone, password, role);
    });
  }
});
</script>
