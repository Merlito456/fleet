<script type="module">
import { db, auth } from './firebaseConfig.js';
import { collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
import { signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";

// Login function
async function login(email, password){
  try {
    const userCredential = await signInWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    // Get user profile from Firestore
    const q = query(collection(db, "users"), where("uid", "==", user.uid));
    const snap = await getDocs(q);
    if (!snap.empty) {
      const profile = snap.docs[0].data();
      localStorage.setItem("user", JSON.stringify(profile));
      alert("Login successful!");
      redirectByRole(profile.role);
    } else {
      alert("No profile found in Firestore.");
    }
  } catch(err) {
    alert(err.message);
  }
}

// Redirect based on role
function redirectByRole(role){
  if(role === "user") window.location.href = "index.html";
  if(role === "rider") window.location.href = "riders.html";
  if(role === "admin") window.location.href = "admin.html";
}

// Form submission
document.getElementById('loginForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  await login(email, password);
});
</script>
